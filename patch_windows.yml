---
- name: Check Windows Update Service Status
  ansible.windows.win_service:
    name: wuauserv
  register: update_service_status

- name: Start Windows Update Service if not running
  ansible.windows.win_service:
    name: wuauserv
    start_mode: auto
    state: started
  when: update_service_status.state != "running"

- name: Search and Install Windows Updates
  ansible.windows.win_updates:
    category_names:
      - SecurityUpdates
      - CriticalUpdates
      - ".NET Framework"
    reboot: yes
    state: installed
  register: update_result

- name: Show installed updates summary
  debug:
    var: update_result

- name: List installed patches (hotfixes)
  ansible.windows.win_shell: |
    Get-HotFix | Select-Object -Property HotFixID, Description, InstalledOn | ConvertTo-Json -Depth 3
  register: installed_patches

- name: Show installed patches
  debug:
    var: installed_patches.stdout | from_json

